# Justfile for prompt optimizer tests
# Install just: https://github.com/casey/just
# Usage: just <command>
# NOTE: Run from the_interviewee directory (parent of prompt_optimizer)

# List available commands
default:
    @just --list

# Run all tests
test:
    python -m pytest prompt_optimizer/tests/ -v

# Run with verbose output
test-verbose:
    python -m pytest prompt_optimizer/tests/ -vv -s

# Run with coverage report
test-coverage:
    python -m pytest prompt_optimizer/tests/ --cov=prompt_optimizer --cov-report=term-missing --cov-report=html
    @echo "\nCoverage report: htmlcov/index.html"

# Run only fast tests (minimal config)
test-fast:
    python -m pytest prompt_optimizer/tests/ -v -k "minimal"

# Run all tests including realistic configs
test-full:
    python -m pytest prompt_optimizer/tests/ -v --durations=10

# Run a specific test file
test-file FILE:
    python -m pytest prompt_optimizer/tests/{{FILE}} -vv -s

# Run a specific test by name pattern
test-match PATTERN:
    python -m pytest prompt_optimizer/tests/ -vv -s -k "{{PATTERN}}"

# Watch mode - rerun tests on file changes (requires pytest-watch)
test-watch:
    ptw prompt_optimizer/tests/ -- -v

# Clean test artifacts
clean:
    find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
    find . -type d -name ".pytest_cache" -exec rm -rf {} + 2>/dev/null || true
    find . -type d -name "htmlcov" -exec rm -rf {} + 2>/dev/null || true
    find . -type f -name "*.pyc" -delete 2>/dev/null || true
    find . -type f -name ".coverage" -delete 2>/dev/null || true
    @echo "Cleaned test artifacts"

# Install test dependencies
install-deps:
    pip install -e ".[test]"
